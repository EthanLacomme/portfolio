// Traductions pour les rÃ©dactions de projets

window.REDACTION_TRANSLATIONS = {
    fr: {
        // GÃ©nÃ©ral
        nav: {
            retourPortfolio: "Retour au portfolio"
        },
        footer: {
            credit: "RÃ©daction de projet | Ethan Lacomme"
        },
        
        // The Crew San Antonio
        the_crew: {
            titre: "Layout - The Crew San Antonio",
            sousTitre: "CrÃ©er un niveau compelling et narratif",
            
            introduction: {
                titre: "Introduction",
                contenu: "The Crew San Antonio est un projet de layout rÃ©alisÃ© dans le cadre de ma formation. Le dÃ©fi principal Ã©tait de crÃ©er un environnement urbain immersif et narratif qui guide le joueur Ã  travers diffÃ©rents quartiers de San Antonio."
            },
            
            objectifs: {
                titre: "Objectifs du Layout",
                contenu: "Les objectifs principaux pour ce projet Ã©taient:",
                points: [
                    "CrÃ©er une expÃ©rience narrative cohÃ©rente",
                    "Guider les mouvements du joueur de maniÃ¨re organique",
                    "Mettre en avant la verticalitÃ© et l'exploration",
                    "Utiliser l'architecture comme outil narratif",
                    "Assurer une lisibilitÃ© visuelle optimale"
                ]
            },
            
            processus: {
                titre: "Processus de CrÃ©ation",
                phases: [
                    {
                        titre: "Analyse et Recherche",
                        contenu: "Phase initiale d'Ã©tude de la ville rÃ©elle, ses architectures caractÃ©ristiques et ses espaces publics."
                    },
                    {
                        titre: "Blockout",
                        contenu: "CrÃ©ation d'une premiÃ¨re version en formes gÃ©omÃ©triques simples pour tester les flux de circulation et les vues."
                    },
                    {
                        titre: "DÃ©coration et Polish",
                        contenu: "Ajout des dÃ©tails architecturaux, des Ã©lÃ©ments dÃ©cor et de l'ambiance visuelle."
                    }
                ]
            },
            
            resultats: {
                titre: "RÃ©sultats et Apprentissages",
                contenu: "Ce projet m'a permis d'acquÃ©rir une comprÃ©hension profonde de la composition spatiale et du level design narratif. J'ai appris Ã  utiliser l'architecture et l'agencement spatial pour crÃ©er une progression naturelle et engageante."
            }
        },
        
        // Gamagoramon
        gamagoramon: {
            titre: "Gamagoramon - Projet de Jeu CrÃ©atif",
            sousTitre: "Un mÃ©lange unique de gameplay et de design visuel",
            
            introduction: {
                titre: "Introduction",
                contenu: "Gamagoramon est un projet de jeu crÃ©atif qui explore l'intersection entre des mÃ©caniques de gameplay innovantes et un design visuel distinctif. Ce projet met en avant l'expÃ©rimentation avec les principes du game design et la vision artistique."
            },
            
            concept: {
                titre: "Concept du Jeu",
                contenu: "Le projet combine des Ã©lÃ©ments de gameplay stratÃ©gique avec une esthÃ©tique visuellement unique, crÃ©ant une expÃ©rience engageante qui se distingue par sa direction artistique distinctive et ses mÃ©caniques crÃ©atives."
            },
            
            objectifs: {
                titre: "Objectifs du Projet",
                contenu: "Les objectifs principaux Ã©taient :",
                points: [
                    "Explorer une vision artistique unique et originale",
                    "DÃ©velopper des mÃ©caniques de gameplay engageantes",
                    "CrÃ©er une cohÃ©sion visuelle distinctive",
                    "Ã‰quilibrer crÃ©ativitÃ© et implÃ©mentation technique",
                    "DÃ©montrer une direction artistique claire"
                ]
            },
            
            resultats: {
                titre: "RÃ©sultats et ExpÃ©rience",
                contenu: "Ce projet a approfondi ma comprÃ©hension des principes du game design, de la cohÃ©sion visuelle et de la faÃ§on d'Ã©quilibrer la vision crÃ©ative avec l'implÃ©mentation technique. Il a dÃ©montrÃ© l'importance du design itÃ©ratif et du maintien d'une direction artistique claire tout au long du dÃ©veloppement."
            },
            
            github: {
                titre: "Voir sur GitHub"
            }
        }
    },
    
    en: {
        // GÃ©nÃ©ral
        nav: {
            retourPortfolio: "Back to portfolio"
        },
        footer: {
            credit: "Project Report | Ethan Lacomme"
        },
        
        // The Crew San Antonio
        the_crew: {
            titre: "Layout - The Crew San Antonio",
            sousTitre: "Creating a compelling and narrative level",
            
            introduction: {
                titre: "Introduction",
                contenu: "The Crew San Antonio is a layout project completed as part of my training. The main challenge was to create an immersive and narrative urban environment that guides the player through different neighborhoods of San Antonio."
            },
            
            objectifs: {
                titre: "Layout Objectives",
                contenu: "The main objectives for this project were:",
                points: [
                    "Create a coherent narrative experience",
                    "Guide player movement organically",
                    "Showcase verticality and exploration",
                    "Use architecture as a narrative tool",
                    "Ensure optimal visual readability"
                ]
            },
            
            processus: {
                titre: "Creation Process",
                phases: [
                    {
                        titre: "Analysis and Research",
                        contenu: "Initial study phase of the real city, its characteristic architectures and public spaces."
                    },
                    {
                        titre: "Blockout",
                        contenu: "Creation of a first version with simple geometric shapes to test circulation flows and views."
                    },
                    {
                        titre: "Decoration and Polish",
                        contenu: "Adding architectural details, decorative elements and visual atmosphere."
                    }
                ]
            },
            
            resultats: {
                titre: "Results and Learnings",
                contenu: "This project allowed me to gain a deep understanding of spatial composition and narrative level design. I learned to use architecture and spatial layout to create natural and engaging progression."
            }
        },
        
        // Gamagoramon
        gamagoramon: {
            titre: "Gamagoramon - Creative Game Project",
            sousTitre: "A unique blend of gameplay and visual design",
            
            introduction: {
                titre: "Introduction",
                contenu: "Gamagoramon is a creative game project that explores the intersection of innovative gameplay mechanics and distinctive visual design. This project showcases experimentation with game design principles and artistic vision."
            },
            
            concept: {
                titre: "Game Concept",
                contenu: "The project combines strategic gameplay elements with a visually unique aesthetic, creating an engaging experience that stands out through its distinctive art direction and creative mechanics."
            },
            
            objectifs: {
                titre: "Project Objectives",
                contenu: "The main objectives were:",
                points: [
                    "Explore a unique and original artistic vision",
                    "Develop engaging gameplay mechanics",
                    "Create distinctive visual cohesion",
                    "Balance creativity with technical implementation",
                    "Demonstrate clear artistic direction"
                ]
            },
            
            resultats: {
                titre: "Results and Experience",
                contenu: "This project deepened my understanding of game design principles, visual cohesion, and how to balance creative vision with technical implementation. It demonstrated the importance of iterative design and maintaining a clear artistic direction throughout development."
            },
            
            github: {
                titre: "View on GitHub"
            }
        }
    }
};

/**
 * RÃ©cupÃ¨re une traduction pour les rÃ©dactions
 * @param {string} key - ClÃ© de traduction (ex: "the_crew.titre")
 * @returns {string} - Texte traduit
 */
function tr(key) {
    const keys = key.split('.');
    const lang = window.currentLanguage || 'en';
    let value = REDACTION_TRANSLATIONS[lang];
    
    for (let k of keys) {
        value = value[k];
        if (!value) return key;
    }
    
    return value;
}

/**
 * Mets Ã  jour le bouton de langue (appelÃ© depuis translations.js)
 */
function updateLanguageButton() {
    const langText = document.getElementById('lang-text');
    const langIcon = document.getElementById('lang-icon');
    
    if (langText) {
        // Affiche la langue vers laquelle on peut aller (l'inverse de la langue actuelle)
        langText.textContent = window.currentLanguage === 'fr' ? 'EN' : 'FR';
    }
    
    if (langIcon) {
        // Affiche le drapeau de la langue vers laquelle on peut aller
        langIcon.textContent = window.currentLanguage === 'fr' ? 'ðŸ‡ºðŸ‡¸' : 'ðŸ‡«ðŸ‡·';
    }
}

/**
 * Mets Ã  jour tous les Ã©lÃ©ments [data-i18n-r] dans une rÃ©daction
 */
function updateRedactionTranslations() {
    document.querySelectorAll('[data-i18n-r]').forEach(el => {
        const key = el.getAttribute('data-i18n-r');
        const translated = tr(key);
        
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
            el.placeholder = translated;
        } else {
            el.textContent = translated;
        }
    });
}

/**
 * Aligne la langue de la rÃ©daction avec celle du portfolio principal
 */
function initRedactionLanguage() {
    // PrioritÃ© 1: ParamÃ¨tre d'URL (lang=fr)
    const urlParams = new URLSearchParams(window.location.search);
    const urlLang = urlParams.get('lang');
    
    // PrioritÃ© 2: window.opener.currentLanguage
    let openerLang = null;
    try {
        openerLang = window.opener && !window.opener.closed ? window.opener.currentLanguage : null;
    } catch (_) {
        openerLang = null;
    }

    // PrioritÃ© 3: window.opener.localStorage
    let openerStoredLang = null;
    try {
        openerStoredLang = window.opener && !window.opener.closed
            ? window.opener.localStorage.getItem('portfolio-language')
            : null;
    } catch (_) {
        openerStoredLang = null;
    }

    // PrioritÃ© 4: localStorage local
    const storedLang = localStorage.getItem('portfolio-language');
    
    // DÃ©terminer la langue finale
    const targetLang = urlLang || openerLang || openerStoredLang || storedLang || 'en';

    console.log('Debug lang sync:', { urlLang, openerLang, openerStoredLang, storedLang, targetLang });

    // Mettre Ã  jour le localStorage local avec la bonne langue
    if (targetLang && storedLang !== targetLang) {
        localStorage.setItem('portfolio-language', targetLang);
    }

    // Forcer la langue dans window.currentLanguage
    window.currentLanguage = targetLang;

    document.documentElement.setAttribute('lang', targetLang);
}

/**
 * Ferme la rÃ©daction pour remettre le focus sur l'onglet d'origine
 */
function closeRedactionPage() {
    const mainUrl = '../../index.html';

    // Toujours tenter de fermer la fenÃªtre pour remettre le focus sur l'onglet parent
    window.close();

    if (window.opener && !window.opener.closed) return;

    if (window.history.length > 1) {
        window.history.back();
        return;
    }

    window.location.replace(mainUrl);
}

// Synchroniser la langue dÃ¨s le chargement du script (avant DOMContentLoaded)
// Cet appel assure que window.currentLanguage est dÃ©fini avant que les traductions ne s'appliquent
initRedactionLanguage();

/**
 * Initialise la rÃ©daction au chargement
 */
document.addEventListener('DOMContentLoaded', function() {
    // RÃ©appeler pour s'assurer que la langue est dÃ©finie correctement 
    // au cas oÃ¹ translations.js l'aurait Ã©crasÃ©e
    initRedactionLanguage();
    
    // Mettre Ã  jour les traductions aprÃ¨s avoir dÃ©fini la langue
    updateRedactionTranslations();

    // Mettre Ã  jour la liste des objectifs dynamiquement
    const objectifsList = document.getElementById('objectifs-list');
    if (objectifsList) {
        const lang = window.currentLanguage || 'en';
        const points = REDACTION_TRANSLATIONS[lang].the_crew.objectifs.points;
        objectifsList.innerHTML = points.map(p => `<li>${p}</li>`).join('');
    }

    const closeBtn = document.querySelector('.btn-close');
    if (closeBtn) {
        closeBtn.addEventListener('click', function(event) {
            event.preventDefault();
            closeRedactionPage();
        });
    }
});
